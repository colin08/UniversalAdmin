@{
    ViewBag.Title = "体检报告";
}

<!-- 头部Style等 -->
@section htmlhead{   
    <style>
        .custom-pullrefresh {
				top: 40px !important;
			}
        .mui-pull-top-pocket{
            top:0 !important;
        }
    </style>

}
<!-- 头部Style等 END -->


<!-- MUI 头部导航栏设置 -->
@section muiheader{
<div class="mui-navbar-inner mui-bar mui-bar-nav">
    <button type="button" onclick="javascript:location.href='@ViewData["BackUrl"]'" class="mui-left mui-action-back mui-btn  mui-btn-link mui-btn-nav mui-pull-left">
        <span class="mui-icon mui-icon-left-nav"></span>
    </button>
    <h1 class="mui-center mui-title">@ViewData["RealName"] 体检报告</h1>
</div>

}
<!-- MUI 头部导航栏设置 END -->


<!-- Body -->

<div class="mui-content-padded" style="min-height:500px;">
    <input type="hidden"  id="hid_idnumber" value="@ViewData["IDNumber"]"/>
    <div id="pullrefresh" class="mui-content mui-scroll-wrapper custom-pullrefresh">
		<div class="mui-scroll">
            <ul class="mui-table-view mui-table-view-chevron" id="ul_data_list" template-id="template_list" pageIndex="1">
                <script type="text/html" id="template_list">
                    {{each data}}
                    <li class="mui-table-view-cell" data-link="{{$value.FilePath}}">
                        <a class="mui-navigate-right">
                            {{$value.Title}}
                        </a>
                    </li>
                    {{/each}}
                </script>

                
            </ul>
            <div id="div_nomore" class="mui-center" style="display:none;text-align:center;margin-top:20px;">没有更多数据了</div>
            @*<div class="mui-bar-footer mui-text-center" style="width: 100%;">
                <p>@Html.Partial("~/Areas/MP/Views/Shared/_Copyright.cshtml")</p>
            </div>*@
        </div>

        
    </div>
</div>



<!-- Body END -->


<!-- MUI 底部导航栏设置 -->
@section muifooter{


}
<!-- MUI 底部导航栏设置 END -->



<!-- MUI 页面底部脚本 -->
@section htmlfoot{
<script src="~/Assets/mui/js/jquery.min.js"></script>
<script src="~/Assets/mui/js/mui.min.js"></script>
<script src="~/Assets/mui/js/template-web.js"></script>
    <script>

        var pageSize = 14;
        var totalPage;//总页码
        mui.init({
            pullRefresh: {
                container: '#pullrefresh',
                down: {
                    auto: true,//可选,默认false.首次加载自动上拉刷新一次
                    callback: pulldownRefresh
                },
                up: {
                    contentrefresh: '正在加载...',
                    callback: pullupRefresh
                }
            }
        });

        /**
		 * 下拉刷新具体业务实现
		 */
        function pulldownRefresh() {
            $('#ul_data_list').attr('pageIndex', 1);
            Ajax_Load_Pullrefresh_Data(true, "ul_data_list");
        }
        /**
		 * 上拉加载具体业务实现
		 */
        function pullupRefresh() {
            Ajax_Load_Pullrefresh_Data(false, "ul_data_list");
        }

        function Ajax_Load_Pullrefresh_Data(reload, ul_id) {
            var ul_page_index = parseInt($('#' + ul_id).attr('pageIndex'));
            if (ul_page_index == 0) ul_page_index = 1;
            var idnmber = $("#hid_idnumber").val();
            unBindTap();
            mui.ajax({
                url: "/MP/MedicalReport/GetPageList",
                data: { "page_size": pageSize, "page_index": ul_page_index,"id_number":idnmber},
                dataType: 'json', //服务器返回json格式数据
                type: 'post', //HTTP请求类型
                //async:false,//同步请求
                timeout: 10000, //超时时间设置为10秒
                success: function (res) {
                    mui('#pullrefresh').pullRefresh().refresh(true);
                    if (res.msg == 0)
                    {
                        if (reload) {
                            mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
                        }
                        mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
                        mui.alert("提示", res.msgbox);
                    }
                    else
                    {
                        $('#' + ul_id).attr('pageIndex', parseInt(ul_page_index) + 1);
                        //取返回的数据
                        var html = template($('#' + ul_id).attr('template-id'), res);
                        //最大页数
                        totalPage = res.total % pageSize != 0 ? parseInt(res.total / pageSize) + 1 : res.total / pageSize;

                        if (res.total == 0)
                        {
                            $(".mui-pull-bottom-pocket").removeClass("mui-visibility");
                            $("#div_nomore").show();
                        } else
                        {
                            $("#div_nomore").hide();
                        }
                        if (reload) {
                            //覆盖数据                            
                            $('#' + ul_id).html(html);
                            mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
                            $(".mui-pull-top-pocket").removeClass("mui-visibility");
                        } else {
                            //追加数据
                            $('#' + ul_id).append(html);
                        }

                        mui('#pullrefresh').pullRefresh().endPullupToRefresh(totalPage <= ul_page_index);
            
                        //绑定li点击事件
                        bindTap();
                    }

                },
                error: function (xhr, type, errorThrown) {
                    //异常处理；
                    mui('#pullrefresh').pullRefresh().refresh(true);
                    if (reload) {
                        mui('#pullrefresh').pullRefresh().endPulldownToRefresh();
                    }
                    mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
                    mui.toast('获取数据失败，请检查网络连接');
                }
            });
        };

        //取消绑定点击事件
        function unBindTap() {
            mui('.mui-table-view').off('tap', 'li');
        }

        //绑定点击事件
        function bindTap()
        {
            mui('.mui-table-view').on('tap', 'li', function (e) {
                window.open(this.getAttribute("data-link"));
            });
        }

    </script>
}
<!-- MUI 页面底部脚本 END -->

