@model Universal.Entity.NewsTag
@{
    ViewBag.Title = "添加标签";
}
<!--头部脚本-->
@section head
{
    @Styles.Render("~/Content/icheck")
    @Styles.Render("~/Content/multiselect")
}
<!--头部脚本 end-->

@section nav
{
}

<!--Main Body-->
<div class="clients-list">
    <form method="post" class="form-horizontal" onsubmit="configm_before()">
        <div style="margin-top:20px;"></div>
        <input type="hidden" id="hid_id" value="@Model.ID" />
        <input type="hidden" id="hid_category_ids" value="@ViewData["CategoryIDs"]" />
        <div class="form-group">
            <label class="col-sm-2 control-label">所属分类</label>
            <div class="col-sm-2">
                @Html.DropDownList("CategoryMultiple", ViewData["CategoryList"] as List<SelectListItem>, new { multiple = "multiple" })
            </div>
            <label class="col-sm-4 label_msg"></label>
        </div>
        <div class="hr-line-dashed"></div>

        <div class="form-group">
            <label class="col-sm-2 control-label">标签名</label>

            <div class="col-sm-3">
                <input type="text" id="tag_title" class="form-control" placeholder="" value="@Model.Title" />
            </div>
            <label class="col-sm-3 label_msg"></label>
        </div>

        <div class="form-group" id="div_weight">
            <label class="col-sm-2 control-label">排序数字</label>
            <div class="col-sm-1">
                <input id="txt_weight" class="form-control" data-val="true" placeholder="数字" type="text" value="@Model.Weight">
                <span class="help-block m-b-none">越大越靠前</span>
            </div>
            <label class="col-sm-3 label_msg"></label>
        </div>
        <div class="hr-line-dashed"></div>

        <div class="hr-line-dashed"></div>
        <div class="row">
            <div class="col-sm-4 col-sm-offset-2">
                <button class="btn btn-info" type="button" onclick="add()">保存内容</button>&nbsp;
            </div>
        </div>

    </form>
</div>
<!-- Main Body end-->
<!--底部脚本-->

@section foot
{
    @Scripts.Render("~/bundles/icheck")
    @Scripts.Render("~/bundles/multiselect")
    <script type="text/javascript">
        $(document).ready(function () {
            $("#CategoryMultiple").multiselect({
                includeSelectAllOption: true,
                //enableFiltering: true,
                //filterPlaceholder: '搜索',
                onChange: function (option, checked) {
                    var selected = [];
                    $('#CategoryMultiple option:selected').each(function () {
                        selected.push([$(this).val(), $(this).data('order')]);
                    });

                    selected.sort(function (a, b) {
                        return a[1] - b[1];
                    });
                    var text = '';
                    for (var i = 0; i < selected.length; i++) {
                        text += selected[i][0] + ',';
                    }
                    text = text.substring(0, text.length - 1);
                    $("#hid_category_ids").val(text);
                }
            });
        });

        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
        function add()
        {
            var category_ids = $("#hid_category_ids").val();
            if (category_ids.length == 0) {
                layer.msg('请选择所属分类', { icon: 5 });
                return;
            }
            var id = $("#hid_id").val();
            var title = $("#tag_title").val();
            if (title.length == 0 || title.length > 10) {
                layer.msg('标签名长度在0~10之间', { icon: 5 });
                return;
            }
            var weight = $("#txt_weight").val();
            if (isNaN(weight)) {
                layer.msg('排序数字输入不正确', { icon: 5 });
                return;
            }

            $.ajax({
                type: "post",
                url: "/admin/NewsTag/Modify",
                data: { "id": id, "category_ids": category_ids, "title": title, "weight": weight},
                async: false,
                beforeSend: function () {

                },
                complete: function () {

                },
                success: function (data) {
                    if (data.msg == 1) {
                        layer.msg(data.msgbox, { icon: 1 });
                        window.setTimeout(function () {
                            parent.layer.close(index);
                            parent.location.reload();
                        }, 500);
                    }
                    else {
                        layer.msg(data.msgbox, { icon: 2 });
                    }
                },
                error: function () {
                    layer.msg("操作失败，请检查网络", { icon: 5 });
                }
            })

        }
    </script>
}
<!--底部脚本 end-->
