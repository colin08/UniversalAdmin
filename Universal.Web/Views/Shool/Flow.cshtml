
@{
    ViewBag.Title = ViewData["TabTitle"];
    ViewData["tabTop"] = "school";
}


<!--头部脚本-->
@section head {
<link rel="stylesheet" type="text/css" href="/assets/css/process_page.css" />
<link rel="stylesheet" type="text/css" href="/assets/flowdesign/js/flowdesign/flowdesign.css" />
<link rel="stylesheet" type="text/css" href="/assets/flowdesign/css/site.css" />
<link rel="stylesheet" type="text/css"	href="/assets/flowdesign/js/jquery.multiselect2side/css/jquery.multiselect2side.css" />
}

<!--头部脚本 end-->
<div class="wapper">
    @Html.Partial("_ShoolMenuLeft", this.ViewData)

    <div class="rightBox">
        <div class="container" style="width: auto">
            <div class="tit1">
                <span>@ViewData["TabTitle"]</span>
            </div>

            <div id="flowdesign_canvas" class="mini-layout container"
                 style="min-height: 1200px"></div>

        </div>

        <div class="footer">Copyright © 深圳市诚泰城市更新咨询服务有限公司 粤ICP备13089427号-1</div>
    </div>

</div>


<!--底部脚本-->
@section foot {
<script type="text/javascript" src="/assets/js/jf.pub.js"></script>`
/*流程图插件↓*/
<script type="text/javascript" src="/assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript"	src="/assets/flowdesign/js/jquery-1.7.2.min.js?2025"></script>
<script type="text/javascript"	src="/assets/flowdesign/js/jquery-ui/jquery-ui-1.9.2-min.js?2025"></script>
<script type="text/javascript"	src="/assets/flowdesign/js/jsPlumb/jquery.jsPlumb-1.3.16-all-min.js?2025"></script>
<script type="text/javascript"	src="/assets/flowdesign/js/jquery.contextmenu.r2.js?2025"></script>
<script type="text/javascript"	src="/assets/js/leipi.project.flowinfo.js"></script>	
/*流程图插件↑*/	
<script type="text/javascript">
var the_flow_id =  @ViewData["flow_id"];
/*流程图JJF ↓*/
function showNodeDetails(dataNode){//节点详情
    $("#node_details_msg").remove();
	var node_details='<div class="node_details_out_bg" id="node_details_msg">'
                    +'<div class="node_details_box">'
                    +'<div class="h_tt">'
                    +'<span>'+dataNode.title+'</span>'
                    +'<a href="javascript:;" class="close" onclick="$(\'#node_details_msg\').remove();">×</a>'
                    +'</div>'
                    +'<ul class="list">'
					
                    +'<li class="clearfix">'
                    +'<p class="l_sid">节点名称：</p>'
                    +'<div class="r_sid">'
                    +'<p>'+dataNode.title+'</p>'
                    +'</div>'
                    +'</li>'
					
                    +'<li class="clearfix">'
                    +'<p class="l_sid">办事地址：</p>'
                    +'<div class="r_sid">'
                    +'<p>';
					if(typeof dataNode.location!="null"&&dataNode.location!="null"&&dataNode.location!=null){
					node_details+=dataNode.location;
					}
					node_details+='</p>'
                    +'</div>'
                    +'</li>'
					
					+'<li class="clearfix">'
					+'<p class="l_sid">联系人：</p>'
					+'<div class="r_sid">';
					
					+'<p>'+dataNode.contacts_user+'</p>'
					+'</div>'
					+'</li>';
					
					if(dataNode.file_list.length>0){
						node_details+='<li class="clearfix">'
						+'<p class="l_sid">节点附件：</p>'
						+'<div class="r_sid">';
						for(var i=0; i<dataNode.file_list.length; i++){
						   node_details+='<p>'+dataNode.file_list[i].file_name+'('+dataNode.file_list[i].file_size+')</p>';
						}
						node_details+='</div>'
						+'</li>';
					}
					
                    node_details+='<li class="clearfix">'
                    +'<p class="l_sid">办事流程说明：</p>'
                    +'<div class="r_sid">'
                    +'<p>';
					if(typeof dataNode.content!="null"&&dataNode.content!="null"&&dataNode.content!=null){
					node_details+=dataNode.content;
					}
					node_details+='</p>'
                    +'</div>'
                    +'</li>'
					
                    +'</ul>'
                    +'</div>'
                    +'</div>';
	$("body").append(node_details);
}
function getNodeList(){//读取节点列表
    var ary=new Array();
    warmMsgFunc(1,'节点列表读取中，请稍后...');
	$.ajax({
		type:'get',
		dataType:'json',
		async:true,
		url:'/Tools/GetFlowCompact',
		data:{
		   flow_id:the_flow_id
		},
		timeout:5000,
		success:function(data){
			warmMsgFunc(0);
			if(data.msg==1){
				var _canvas = $("#flowdesign_canvas").Flowdesign({
					"processData":data
					,//这是连接线路的绘画样式
					connectorPaintStyle : {
						lineWidth:3,
						strokeStyle:"#49afcd",
						joinstyle:"round"
					},//鼠标经过样式
					connectorHoverStyle : {
						lineWidth:3,
						strokeStyle:"#da4f49"
					},
					fnClick:function(){
					    var activeId = _canvas.getNodeId();//右键当前的ID
						//window.open("/Project/FlowNodeInfo?id="+activeId);
						if(!ary[activeId]){
							 warmMsgFunc(1,'节点信息读取中，请稍后...');
							 $.ajax({
								type:'get',
								dataType:'json',
								async:true,
								url:'/Tools/GetNodeInfo',
								data:{
								   id:activeId
								},
								timeout:5000,
								success:function(data){
									 warmMsgFunc(0);
									 showNodeDetails(data);
									 ary[activeId]=data;
								},
								error:function(XMLHttpRequest, textStatus, errorThrown){
									warmMsgFunc(0);
									operatingMsgFunc(1,'节点信息获取失败：'+XMLHttpRequest.status);
									console.log(XMLHttpRequest.status);
								}
							 });	
						}
						else{
							 showNodeDetails(ary[activeId]);
						}
					}
				});			   
			}
			else{
			   operatingMsgFunc(1,'操作失败：'+data.msgbox);
			}
		},
		error:function(XMLHttpRequest, textStatus, errorThrown){
			warmMsgFunc(0);
			operatingMsgFunc(1,'操作失败：'+XMLHttpRequest.status);
			console.log(XMLHttpRequest.status);
		}
	});	
}
$(function(){
    getNodeList();
});
/*流程图JJF ↑*/
</script>

}
<!--底部脚本 end-->
