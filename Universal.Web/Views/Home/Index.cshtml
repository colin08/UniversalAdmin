@model Universal.Web.Models.ViewModelIndex
@{
    ViewBag.Title = "首页";
    ViewData["tabTop"] = "home";
}

<!--头部脚本-->
@section head
{
    <link href="~/Assets/theme/css/home.css" rel="stylesheet" />
}
<!--头部脚本 end-->

<div class="wrapper">
    @if (Model.TopNotice != null)
    {
        <div class="public">
            <i class="i-public"></i>
            <div class="publicScroll">

                <ul>
                    <li><a href="/Info/Notice?id=@Model.TopNotice.ID" title="公告"> @Universal.Tools.StringHelper.CutString(Model.TopNotice.Content, 85) </a></li>
                </ul>
            </div>
        </div>
    }
    <div class="clear"></div>
    <div class="homeWrap">
        <div class="homeLt">
            <div class="homeBox">
                <div class="titH"><i class="i-lm5"></i><span>项目动态</span><a href="/Project/Index" title="更多" class="btn25 red fr"><i class="i-wplus"></i><em>更多</em></a></div>
                <div class="homelist">
                    <table border="0" cellspacing="0" cellpadding="0" class="homeTable">
						<thead>
                        <tr>
                            <td width="18%">项目名称</td>
                            <td width="25%">当前节点</td>
                            <td width="27%">节点备注</td>
                            <td width="10%">最新修改</td>
                            <td width="15%">修改时间</td>
                            <td width="5%" align="center">操作</td>
                            </tr>
                        </thead>
                        <tbody id="listData"></tbody>
                    </table>
                </div>
            </div>

            <div class="homeBox mt_20">
                <div class="titH"><i class="i-lm6"></i><span>最新秘籍</span><a href="/Shool/Index" title="更多" class="btn25 red fr"><i class="i-puload"></i><em>更多</em></a></div>
                <div class="homelist">
                    <table border="0" cellspacing="0" cellpadding="0" class="homeTable">
                    <thead>
                        <tr>
                            <td width="40%">秘籍标题</td>
                            <td>分类</td>
                            <td width="10%">上传者</td>
                            <td width="15%">上传时间</td>
                            <td width="15%" align="center">操作</td>
                        </tr>
                        </thead>
                        @foreach (var item in Model.DocumentList)
                        {
                            <tr>
                                <td><a href="/Info/Doc?id=@item.ID&b=1">@Universal.Tools.StringHelper.CutString(item.Title, 25)</a></td>
                                <td><a href="/Document/Index?doc_id=@item.DocCategoryID">@Universal.Tools.StringHelper.CutString(item.CategoryName, 6)</a></td>
                                <td>@item.CusUser.NickName</td>
                                <td>@item.LastUpdateTime.ToString("yy-MM-dd HH:mm")</td>
                                <td id="doc_@item.ID">
                                <a href="/share/doc?id=@item.ID&b=1" target="_blank"><i class="i-share"></i></a>
                                <a href="javascript:;" onclick="fav(@item.ID)">
                                <i id="i_fav_@item.ID" class="@item.FavIcon" style="margin:0"></i></a>
                                @{
                                    var str_json = Newtonsoft.Json.JsonConvert.SerializeObject(item.FileList.ToList());
                                }
                                <script>
                                    addDownUrlJJF('@item.ID',@Html.Raw(str_json));
                                </script>
                                </td>
                            </tr>
                        }
                    </table>
                </div>
            </div>
        </div>
        <div class="homeRt">
            <div class="titH"><i class="i-lm8"></i><span>我的待办</span> </div>
            <div class="homeRlist">
                @if (Model.JobTask.Count > 0)
                {
                    <ul>
                        @foreach (var item in Model.JobTask)
                        {
                            <li>
                                <a href="@item.LinkUrl" title="@item.Content">
                                    <em><i class="i-shareB"></i></em>
                                    <h4>@(Universal.Tools.StringHelper.CutString(item.Content, 14))</h4>
                                    <p>@item.TypeName  @item.AddTime</p>
                                </a>
                            </li>
                        }
                    </ul>
                }else
                {
                    <p>没有待办</p>
                }

                <a href="/User/Message" title="#" class="loadMore"><i class="i-arrR"></i>查看更多</a>
            </div>
        </div>
    </div>

</div>


<div class="footer">Copyright ©  深圳花伴里实业集团有限公司  粤ICP备13089427号-1</div>


<!--底部脚本-->
@section foot
{
    <script type="text/javascript">

        $(document).ready(function (e) {
            pageData();
        });

        /*******************列表 end *************************/
        //分页方法
        function pageData() {
            $.ajax({
                type: "post",
                url: "/Project/PageData",
                data: { "page_size": 6, "page_index": 1, "only_mine": false, "keyword": "", "status": 0, "node_category_id": 0, "begin_time": null, "end_time": null, "is_admin": false },
                async: false, //同步请求
                datatype: "json",
                beforeSend: function () {
                    $("#listData").html("<tr><td colspan=\"10\"><p style='text-align:center;font-size:16px;'>项目加载中。。。</p></td><tr>");
                },
                success: function (data) {
                    if (data.msg == 0) {
                        $("#listData").html("<tr><td colspan=\"10\"><p style='text-align:center;font-size:16px;'>项目加载失败:" + data.msgbox + "</p></td><tr>");
                        return;
                    }
                    $("#listData").html("");
                    var dataHtml = "";
                    $.each(data.data, function (i, item) {
                        var node_link = "javascript:;";
                        if (item.ProjectFlowNodeDoing.flow_node_id != -1)
                        {
                            //node_link = "/Project/FlowNodeInfo?id=" + item.ProjectFlowNodeDoing.flow_node_id;
                            node_link="/Project/FlowInfo?id="+item.ID;
                        }

                        dataHtml += "<tr>";
                        dataHtml += "<td><a href=\"/Project/BasicInfo?id=" + item.ID + "&b=1\">" + CutString(item.Title, 10) + "</a></td>";
                        dataHtml += "<td><a href='" + node_link + "'>" + CutString(item.ProjectFlowNodeDoing.node_title, 15) + "</a></td>";
                        dataHtml += "<td><a href='" + node_link + "'>" + CutString(item.ProjectFlowNodeDoing.flow_node_remark, 16) + "</a></td>";
                        dataHtml += "<td>" + item.CusUser.NickName + "</td>";
                        dataHtml += "<td>" + ChangeDateFormat(item.LastUpdateTime, "") + "</td>";
                        dataHtml += "<td style=\"text-align:center\"><a href=\"javascript:;\" onclick='fav_pro(" + item.ID + ")'><i id=\"i_project_" + item.ID + "\" class=\"" + item.FavIcon + "\"></i></a></td>";
                        dataHtml += "</tr>";
                    });
                    if (data.data.length == 0) {
                        dataHtml += "<tr><td colspan=\"10\"><p style='text-align:center;font-size:16px;'>没有相关数据</p></td><tr>";
                    }
                    $("#listData").html(dataHtml);

                },
                error: function () {
                    $("#listData").html("<tr><td colspan=\"10\"><p style='text-align:center;font-size:16px;'>项目加载失败</p></td><tr>");
                }
            })
        }
        /*******************列表 end *************************/

        function down(linkstr, title) {
            if (linkstr.length > 0) {
                $.post('/Home/AddDownLog', { "title": title }, function (text, status) { window.open(linkstr) });
            }
        }

        function fav_pro(id) {
            $.ajax({
                type: "post",
                url: "/Project/AddFavorites",
                data: { "id": id },
                async: false,
                beforeSend: function () {

                },
                complete: function () {

                },
                success: function (data) {
                    if (data.msg == 1) {
                        if (data.msgbox == "取消收藏成功") {
                            $("#i_project_" + id).attr("class", "i-favG");
                        } else {
                            //已收藏
                            $("#i_project_" + id).attr("class", "i-fav");
                        }
                    }
                    else {
                        alert(data.msgbox);
                    }
                },
                error: function () {
                    alert("操作失败，请检查网络");
                }
            })
        }

        function fav(id) {

            $.ajax({
                type: "post",
                url: "/Shool/Fav",
                data: { "id": id },
                async: false,
                beforeSend: function () {

                },
                complete: function () {

                },
                success: function (data) {
                    if(data.msg ==1)
                    {
                        if(data.msgbox=="取消收藏成功")
                        {
                            $("#i_fav_"+id).attr("class","i-favG");
                        }else
                        {
                            //已收藏
                            $("#i_fav_"+id).attr("class","i-fav");
                        }
                    }
                },
                error: function () {
                    alert("操作失败，请检查网络");
                }
            })
        }
                                </script>
}

<!--底部脚本 end-->
